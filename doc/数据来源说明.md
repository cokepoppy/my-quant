# 数据来源说明

## 概述

本文档详细说明了量化交易系统中数据库中的1000多条市场数据的来源、生成方式和用途。

## 数据来源

### 1. 模拟数据生成脚本

**主要脚本**: `/mnt/d/home/my-quant/backend/scripts/generate-mock-data.ts`

这是生成数据库中市场数据的主要脚本，通过算法模拟真实的市场价格波动。

#### 生成的数据特征

- **交易对**: BTCUSDT, ETHUSDT, BNBUSDT
- **时间范围**: 2024年1月1日 - 2024年12月31日
- **数据频率**: 每日数据 (1d interval)
- **数据量**: 每个交易对约365条记录，总共约1000+条记录
- **数据类型**: OHLCV (Open, High, Low, Close, Volume)

#### 数据生成算法

```typescript
// 起始价格设置
const currentPrice = symbol === 'BTCUSDT' ? 45000 : 
                      symbol === 'ETHUSDT' ? 2500 : 300;

// 价格波动模拟 (±5% 日内波动)
const change = (Math.random() - 0.5) * 0.1;
const open = currentPrice;
const close = currentPrice * (1 + change);
const high = Math.max(open, close) * (1 + Math.random() * 0.02);
const low = Math.min(open, close) * (1 - Math.random() * 0.02);
const volume = Math.random() * 1000000 + 100000;

// 生成的数据记录
{
  symbol: 'BTCUSDT',
  timestamp: new Date(currentDate),
  open: 45000.0,
  high: 45900.0,
  low: 44100.0,
  close: 45250.0,
  volume: 1250000.0,
  interval: '1d',
  source: 'generated'
}
```

#### 价格波动逻辑

1. **日内波动**: 每日价格波动范围控制在 ±5%
2. **高低价计算**: 基于开盘价和收盘价，加上随机波动 (±2%)
3. **成交量模拟**: 随机生成 100,000 - 1,100,000 之间的成交量
4. **价格连续性**: 下一日的开盘价等于前一日的收盘价

### 2. 数据存储方式

#### 数据库结构

- **数据库**: TimescaleDB PostgreSQL
- **表名**: market_data
- **存储类型**: TimescaleDB Hypertable (时间序列优化)
- **数据源标记**: source 字段标记为 'generated'

#### 数据库索引优化

```sql
-- 复合索引优化查询性能
CREATE INDEX idx_market_data_symbol_timestamp 
ON market_data (symbol, timestamp DESC);

-- 时间间隔索引
CREATE INDEX idx_market_data_interval 
ON market_data (interval);

-- TimescaleDB 超表
SELECT create_hypertable('market_data', 'timestamp', if_not_exists => TRUE);
```

### 3. 数据运行方式

#### 脚本执行

```bash
# 进入后端目录
cd /mnt/d/home/my-quant/backend

# 运行数据生成脚本
npx ts-node scripts/generate-mock-data.ts

# 或者通过 npm 脚本运行
npm run script:generate-mock-data
```

#### 数据库初始化

数据库初始化脚本 `init-database.ts` 会：

1. **生成 Prisma 客户端**
2. **运行数据库迁移**
3. **创建 TimescaleDB 超表**
4. **创建数据库索引**
5. **插入示例用户和策略**

注意：初始化脚本不会自动生成市场数据，需要单独运行 `generate-mock-data.ts`。

### 4. 数据用途

#### 开发和测试

- **系统测试**: 验证回测引擎功能
- **前端展示**: 提供图表和统计数据
- **API测试**: 测试数据接口的正确性
- **开发调试**: 作为开发环境的测试数据

#### 功能验证

- **回测引擎**: 测试策略回测功能
- **数据查询**: 验证时间序列查询性能
- **图表渲染**: 测试前端图表组件
- **数据分析**: 验证统计计算准确性

### 5. 数据特点

#### 真实性模拟

- **价格波动**: 符合真实市场的价格波动特征
- **成交量模式**: 模拟真实市场的成交量分布
- **时间连续性**: 保持价格的连续性和合理性
- **多交易对**: 支持多个主流加密货币交易对

#### 数据完整性

- **OHLCV数据**: 完整的开盘、最高、最低、收盘、成交量数据
- **时间戳**: 精确到毫秒级时间戳
- **交易对标识**: 清晰的交易对符号标识
- **数据来源**: 明确标记为生成数据

### 6. 与真实数据的区别

#### 模拟数据限制

- **无市场情绪**: 不包含真实市场的情绪因素
- **无新闻事件**: 不响应真实世界的新闻事件
- **规律性较强**: 价格波动相对规律，缺乏突发事件
- **无交易成本**: 不考虑滑点和手续费等实际交易成本

#### 适用场景

- **开发环境**: 适合开发和测试使用
- **功能验证**: 验证系统功能是否正常
- **性能测试**: 测试系统性能和稳定性
- **演示用途**: 用于系统演示和展示

### 7. 扩展数据源

#### 计划中的数据源

根据 `DataSourceTest.vue` 组件，系统计划支持以下数据源：

1. **Binance API**
   - REST API: 历史数据获取
   - WebSocket: 实时数据流
   - 支持多种时间周期

2. **OKX API**
   - 市场数据接口
   - 实时价格数据
   - 历史K线数据

3. **Yahoo Finance**
   - 股票市场数据
   - 加密货币数据
   - 财经指标数据

#### 数据导入功能

系统还支持通过CSV文件导入历史数据：

- **文件上传**: 支持CSV格式数据文件
- **数据验证**: 自动验证数据格式和完整性
- **批量导入**: 支持大量历史数据的批量导入
- **错误处理**: 完善的错误处理和日志记录

### 8. 数据管理

#### 数据清理

```typescript
// 清理现有数据
await prisma.marketData.deleteMany({
  where: {
    source: 'generated'
  }
});
```

#### 数据更新

```typescript
// 更新特定时间范围的数据
await prisma.marketData.updateMany({
  where: {
    symbol: 'BTCUSDT',
    timestamp: {
      gte: new Date('2024-01-01'),
      lte: new Date('2024-12-31')
    }
  },
  data: {
    source: 'updated'
  }
});
```

#### 数据查询

```typescript
// 查询特定交易对的数据
const data = await prisma.marketData.findMany({
  where: {
    symbol: 'BTCUSDT',
    timestamp: {
      gte: new Date('2024-01-01'),
      lte: new Date('2024-12-31')
    }
  },
  orderBy: {
    timestamp: 'asc'
  }
});
```

## 总结

数据库中的1000多条市场数据是通过 `generate-mock-data.ts` 脚本生成的模拟数据，主要用于：

1. **开发和测试**: 提供开发和测试环境的数据支持
2. **功能验证**: 验证系统各模块功能的正确性
3. **演示展示**: 作为系统演示的数据基础
4. **性能测试**: 测试系统性能和稳定性

这些数据虽然是模拟生成的，但具有真实市场数据的基本特征，为量化交易系统的开发和完善提供了重要的数据支持。随着系统的发展，将逐步接入真实的市场数据源，提供更准确的交易决策支持。