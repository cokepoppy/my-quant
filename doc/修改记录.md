# 修改记录

## 2025-08-25

### 修复1：策略列表加载失败问题
**问题**: StrategyList.vue:295 加载策略列表失败: Error: 获取策略列表失败

**原因分析**:
1. 前端配置错误：`VITE_API_URL=http://localhost:8000/api`，但后端路由不使用 `/api` 前缀
2. CORS配置错误：后端允许的来源是 `http://localhost:3001`，但前端运行在不同端口
3. 后端服务未正确启动

**解决方案**:
1. 修改 `frontend/.env`：
   - `VITE_API_URL=http://localhost:8000/api` → `VITE_API_URL=http://localhost:8000`
2. 修改 `backend/.env`：
   - `CORS_ORIGIN=http://localhost:3001` → `CORS_ORIGIN=http://localhost:3002` → `CORS_ORIGIN=http://localhost:3001`
3. 重启后端服务以应用CORS配置

### 修复2：动态导入模块失败
**问题**: TypeError: Failed to fetch dynamically imported module: http://localhost:3001/src/views/BacktestSettings.vue

**原因分析**:
1. 组件文件路径不正确
2. TabSystem.vue 中的动态导入路径与实际文件位置不匹配

**解决方案**:
1. 重新组织文件结构：
   - `BacktestSettings.vue` 从 `/views/` 移动到 `/views/backtest/`
   - `TradingPanel.vue` 从 `/views/` 移动到 `/views/trading/`
   - `DashboardOverview.vue` 从 `/views/` 移动到 `/views/dashboard/`
2. 更新 `TabSystem.vue` 中的组件映射：
   - `'@/views/BacktestSettings.vue'` → `'@/views/backtest/BacktestSettings.vue'`
   - `'@/views/TradingPanel.vue'` → `'@/views/trading/TradingPanel.vue'`
   - `'@/views/DashboardOverview.vue'` → `'@/views/dashboard/DashboardOverview.vue'`

## 文件修改清单

### 前端配置文件
1. `/frontend/.env` - 更新API URL配置
2. `/frontend/src/components/layout/TabSystem.vue` - 修复动态导入路径

### 后端配置文件
1. `/backend/.env` - 更新CORS配置

### 文件移动
1. `/frontend/src/views/BacktestSettings.vue` → `/frontend/src/views/backtest/BacktestSettings.vue`
2. `/frontend/src/views/TradingPanel.vue` → `/frontend/src/views/trading/TradingPanel.vue`
3. `/frontend/src/views/DashboardOverview.vue` → `/frontend/src/views/dashboard/DashboardOverview.vue`

## 验证结果
- 后端健康检查：✅ http://localhost:8000/health
- 策略API端点：✅ http://localhost:8000/strategies (需要认证)
- 前端服务：✅ http://localhost:3001
- CORS配置：✅ 前后端端口匹配

### 修复3：回测结果侧边栏点击无反应
**问题**: 点击回测结果侧边栏没有反应

**原因分析**:
1. `SidebarNav.vue` 中定义了 `'backtest-results'` 导航项
2. `V3Layout.vue` 中的 `handleNavClick` 方法缺少 `'backtest-results'` 的映射
3. `TabSystem.vue` 中缺少 `BacktestResult` 组件的动态导入配置

**解决方案**:
1. 更新 `V3Layout.vue` 中的导航映射：
   - 在 `tabComponents` 中添加 `'backtest-results': 'BacktestResult'`
   - 在 `tabTitles` 中添加 `'backtest-results': '回测结果'`
   - 在 `tabIcons` 中添加 `'backtest-results': 'DataLine'`
2. 更新 `TabSystem.vue` 中的组件映射：
   - 添加 `'BacktestResult': defineAsyncComponent(() => import('@/views/backtest/BacktestResult.vue'))`

### 修复四：策略模板侧边栏点击无响应问题
**问题描述**：点击左侧导航栏的"策略模板"没有响应

**根本原因**：
- `V3Layout.vue` 的 `handleNavClick` 方法中缺少 'strategy-templates' 的映射
- `TabSystem.vue` 的 `componentMap` 中缺少 'StrategyTemplates' 组件映射

**解决方案**：
1. 更新 `V3Layout.vue` 中的导航映射：
   - 在 `tabComponents` 中添加 `'strategy-templates': 'StrategyTemplates'`
   - 在 `tabTitles` 中添加 `'strategy-templates': '策略模板'`
   - 在 `tabIcons` 中添加 `'strategy-templates': 'Files'`
2. 更新 `TabSystem.vue` 中的组件映射：
   - 添加 `'StrategyTemplates': defineAsyncComponent(() => import('@/components/strategy/TemplateList.vue'))`

## 后续建议
1. 考虑为后端API添加 `/api` 前缀以保持一致性
2. 实施更严格的组件文件组织规范
3. 添加构建时的路径验证检查
4. 考虑使用绝对路径别名来避免此类问题
5. 建立导航项与组件映射的检查机制，避免遗漏映射
5. 建立导航项与组件映射的检查机制，确保完整性

### 修复五：策略模板组件渲染错误
**问题描述**：点击策略模板侧边栏后，组件渲染时报错 "TypeError: Cannot read properties of undefined (reading 'length')"

**根本原因**：
- `TemplateList.vue` 组件期望接收 `templates` prop，但在作为 StrategyTemplates 使用时没有传递该属性
- 组件没有为 `props.templates` 提供默认值

**解决方案**：
1. 更新 `TemplateList.vue` 组件：
   - 添加 `withDefaults` 导入
   - 为 `templates` prop 提供默认空数组 `() => []`
   - 添加默认模板数据 `defaultTemplates`，在无外部数据时使用
   - 修改 `filteredTemplates` 计算属性逻辑，优先使用传入的数据，否则使用默认数据

**默认模板数据**：
- 双均线策略（初级，趋势跟踪）
- RSI超买超卖策略（中级，动量反转）